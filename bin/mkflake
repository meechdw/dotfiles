#!/usr/bin/env bash

# Generates a flake.nix file with the specified packages

if [ "$#" -eq 0 ]; then
    echo -e "\033[1;95mwarning:\033[0m generating flake.nix with no packages, you can specify packages as arguments"
fi

packages=$@
description="Development environment"

cat > flake.nix << EOF
{
  description = "$description";

  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";
  inputs.flake-utils.url = "github:numtide/flake-utils";

  outputs = { self, nixpkgs, flake-utils }:
    flake-utils.lib.eachDefaultSystem (system:
      let
        pkgs = nixpkgs.legacyPackages.\${system};
      in {
        _ = self;

        devShells.default = pkgs.mkShell {
          buildInputs = with pkgs; [
$(for pkg in $packages; do echo "            $pkg"; done)
          ];
        };
      }
    );
}
EOF

if [ -d .git ]; then
    git add flake.nix
fi

echo "use flake" > .envrc

direnv allow
